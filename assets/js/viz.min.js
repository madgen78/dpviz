!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.Viz=r()}(this,function(){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},e=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e};function t(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var d=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n,t=arguments[r];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},i=(e(r,[{key:"render",value:function(r,i){var o=this;return new Promise(function(n,t){var e=o.nextId++;o.listeners[e]=function(e,r){e?t(new Error(e.message,e.fileName,e.lineNumber)):n(r)},o.worker.postMessage({id:e,src:r,options:i})})}}]),r);function r(e){var t=this;a(this,r),this.worker=e,this.listeners=[],this.nextId=0,this.worker.addEventListener("message",function(e){var r=e.data.id,n=e.data.error,e=e.data.result;t.listeners[r](n,e),delete t.listeners[r]})}var s=function e(r,i){a(this,e);var o=r();this.render=function(n,t){return new Promise(function(e,r){try{e(i(o,n,t))}catch(e){r(e)}})}};function u(){return"devicePixelRatio"in window&&1<window.devicePixelRatio?window.devicePixelRatio:1}function l(e,r){var n=1<arguments.length&&void 0!==r?r:{},r=n.scale,i=void 0===r?u():r,r=n.mimeType,o=void 0===r?"image/png":r,n=n.quality,a=void 0===n?1:n;return new Promise(function(n,r){var t=new Image;t.onload=function(){var e=document.createElement("canvas");e.width=t.width*i,e.height=t.height*i,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e.toBlob(function(e){var r=new Image;r.src=URL.createObjectURL(e),r.width=t.width,r.height=t.height,n(r)},o,a)},t.onerror=function(e){e="error"in e?e.error:new Error("Error loading SVG");r(e)},t.src="data:image/svg+xml;base64,"+btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,r){return String.fromCharCode("0x"+r)}))})}function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.workerURL,n=e.worker,t=e.Module,e=e.render;if(a(this,c),void 0!==r)this.wrapper=new i(new Worker(r));else if(void 0!==n)this.wrapper=new i(n);else if(void 0!==t&&void 0!==e)this.wrapper=new s(t,e);else{if(void 0===c.Module||void 0===c.render)throw new Error("Must specify workerURL or worker option, Module and render options, or include one of full.render.js or lite.render.js after viz.js.");this.wrapper=new s(c.Module,c.render)}}return e(c,[{key:"renderString",value:function(e){for(var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=r.format,t=void 0===n?"svg":n,i=r.engine,n=void 0===i?"dot":i,i=r.files,o=void 0===i?[]:i,i=r.images,a=void 0===i?[]:i,r=r.yInvert,r=void 0!==r&&r,d=0;d<a.length;d++)o.push({path:a[d].path,data:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg width="'+a[d].width+'" height="'+a[d].height+'"></svg>'});return this.wrapper.render(e,{format:t,engine:n,files:o,images:a,yInvert:r})}},{key:"renderSVGElement",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.renderString(e,d({},r,{format:"svg"})).then(function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement})}},{key:"renderImageElement",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=r.scale,t=r.mimeType,i=r.quality;return this.renderString(e,d({},r,{format:"svg"})).then(function(e){return("object"===("undefined"==typeof fabric?"undefined":o(fabric))&&fabric.loadSVGFromString?function(e,r){var n=1<arguments.length&&void 0!==r?r:{},r=void 0===(t=n.scale)?u():t,t=void 0===(t=n.mimeType)?"image/png":t,o=void 0===(n=n.quality)?1:n,a=r,d=void 0;return"image/jpeg"==t?d="jpeg":"image/png"==t&&(d="png"),new Promise(function(t,i){fabric.loadSVGFromString(e,function(e,r){0==e.length&&i(new Error("Error loading SVG with Fabric"));var n=document.createElement("canvas");n.width=r.width,n.height=r.height;n=new fabric.Canvas(n,{enableRetinaScaling:!1}),e=fabric.util.groupSVGElements(e,r);n.add(e).renderAll();e=new Image;e.src=n.toDataURL({format:d,multiplier:a,quality:o}),e.width=r.width,e.height=r.height,t(e)})})}:l)(e,{scale:n,mimeType:t,quality:i})})}},{key:"renderJSONObject",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=r.format;return"json"===n&&"json0"===n||(n="json"),this.renderString(e,d({},r,{format:n})).then(function(e){return JSON.parse(e)})}}]),c});